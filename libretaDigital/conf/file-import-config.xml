<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">
	
	
	<bean id="upload.fileMgrFactory" class="uy.com.geocom.geoswitch.usecontrol.fileprocessor.importer.FileUploadBlockManagerFactory">
		<property name="allowedErrorRate" value="0.5" />
		<property name="minRecordsToCheckErrorAverage" value="2000" />
		<property name="dumpFileErrors" value="true" />
				
		<property name="blockSize" value="${import.uploadBlockSize}" />
		<property name="switchTEMPFolderPath" value="${import.switchTEMPFolderPath}" />
		<property name="consoleLOGSFolderPath" value="${import.consoleLOGSFolderPath}" />
	</bean>
	
	<bean id="upload.fileImporter" class="com.libretaDigital.fileupload.FileImporter">
		<property name="taskExecutor" ref="upload.taskExecutor" />
		<property name="blockProcessor" ref="usecontrol.upload.blockProcessor"/>
		<property name="parametersFacade" ref="unimarc.parametersFacade" />
	</bean>
	
	<bean name="fileupload.facade" class="com.libretaDigital.fileupload.FileUploadFacadeImpl">
		<property name="uploaderFacade" ref="uploaderFacade" />
		<property name="fileUploadProfessorParser" ref="fileUploadProfessorParser" />
		<property name="publishFileAddress" value="${publish_file_address}" />
		<property name="folderTempPath" value="${import.switchTEMPFolderPath}" />
	</bean>
	
	<bean id="fileUploadProfessorParser" class="com.libretaDigital.fileupload.FileUploadProfessorParser" >
		<property name="splitChar" value="${fileupload.split.char}" />
		<property name="subClassSplitChar" value="${fileupload.subclass.split.char}" />
		<property name="fieldsInvalidMsg" value="${fileupload.invalid.field.message}" />
		<property name="errorMsgs" ref="errorMsgsMap" />
		<property name="gradeFieldLenght" value="${fileupload.gradeFieldLenght}" />
	</bean>
	
	<bean name="geouploaderFacade" class="uy.com.geocom.util.geouploader.GeouploaderFacadeImpl">
		<property name="uploadHistorySize" value="${import.uploadHistorySize}" />
		<property name="fileImporter" ref="upload.fileImporter" />
		<property name="fileUploadManagerFactory" ref="upload.fileMgrFactory" />
		<!-- This is the queue of the elements that will be imported asinchronically, could be joined with other proceses, so we ensure that only one module will be working-->
		<property name="asynchTaskExcecutor" ref="asynchTaskExecutor" />
	</bean>
	
	<bean id="upload.properties" class="com.libretaDigital.fileupload.UploaderProperties">
		<property name="dumpFileErrors" value="${import.dumpFileErrors}" />
		<property name="allowedErrorRate" value="${import.allowedErrorRate}" />
		<property name="minRecordsToCheckErrorAverage" value="${import.minRecordsToCheckErrorAverage}" />
				
		<property name="blockSize" value="${import.uploadBlockSize}" />
		<property name="switchTEMPFolderPath" value="${import.switchTEMPFolderPath}" />
		<property name="consoleLOGSFolderPath" value="${import.consoleLOGSFolderPath}" />
		
		<property name="startFileUploadMSG" value="${import.startFileUploadMSG}" />
		<property name="errorOnLineMSG" value="${import.errorOnLineMSG}" />
		<property name="endBlockMSG" value="${import.endBlockMSG}" />
		<property name="abortFileUploadMSG" value="${import.abortFileUploadMSG}" />
		<property name="endFileUploadMSG" value="${import.endFileUploadMSG}" />

		<property name="invalidFormatLine" value="${import.invalidFormatLine}"/>
		<property name="exceptionReadingBlock" value="${import.exceptionReadingBlock}"/>
	</bean>
	
	<bean id="libretaDigital.upload.transactionProcessor"
		class="uy.com.geocom.geoswitch.financial.unimarc.business.geouploader.TransactionProcessorImpl">
		<property name="uploadProcessorMap">
			<map>
				<entry>
					<key>
						<util:constant
							static-field="com.libretaDigital.fileupload.PROFESSOR" />
					</key>
					<ref bean="fileUploadLineProcessor" />
				</entry>
				<entry>
					<key>
						<util:constant
							static-field="com.libretaDigital.fileupload.STUDENT" />
					</key>
					<ref bean="fileUploadLineProcessor" />
				</entry>
				<entry>
					<key>
						<util:constant
							static-field="com.libretaDigital.fileupload.GROUP" />
					</key>
					<ref bean="fileUploadLineProcessor" />
				</entry>
			</map>
		</property>
	</bean>
	
	<util:map id="upload.ProcessorMap">
		<entry>
			<key>
				<util:constant
					static-field="com.libretaDigital.fileupload.PROFESSOR" />
			</key>
			<ref bean="fileUploadLineProcessor" />
		</entry>
		<entry>
			<key>
				<util:constant
					static-field="com.libretaDigital.fileupload.STUDENT" />
			</key>
			<ref bean="fileUploadLineProcessor" />
		</entry>
		<entry>
			<key>
				<util:constant
					static-field="com.libretaDigital.fileupload.GROUP" />
			</key>
			<ref bean="fileUploadLineProcessor" />
		</entry>
	</util:map>
	
</beans>